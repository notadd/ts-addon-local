{"version":3,"sources":["../src/util/file.util.ts"],"names":[],"mappings":"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","file":"file.util.js","sourcesContent":["import { Component, HttpException } from \"@nestjs/common\";\nimport * as fs from \"fs\";\n\n/* 异步操作文件的封装工具类 */\n@Component()\nexport class FileUtil {\n\n    constructor() {\n    }\n\n    async write(path: string, buffer: Buffer): Promise<void> {\n        let ex: any = \"\";\n        await new Promise((resolver, reject) => {\n            fs.writeFile(path, buffer, (err) => {\n                if (err) {\n                    reject(new HttpException(\"文件写入磁盘错误:\" + err.toString(), 405));\n                }\n                resolver();\n            });\n        }).catch(err => {\n            ex = err;\n        });\n        if (ex) {\n            throw ex;\n        }\n    }\n\n    async read(path: string): Promise<Buffer> {\n        let ex: any = \"\", result: Buffer = new Buffer(0);\n        await new Promise((resolver, reject) => {\n            fs.readFile(path, (err, buffer) => {\n                if (err) {\n                    reject(new HttpException(\"读取文件错误:\" + err.toString(), 405));\n                }\n                result = buffer;\n                resolver();\n            });\n        }).catch(err => {\n            ex = err;\n        });\n        if (ex) {\n            throw ex;\n        }\n        return result;\n    }\n\n    async delete(path: string): Promise<void> {\n        let ex: any = \"\";\n        await new Promise((resolver, reject) => {\n            fs.unlink(path, (err) => {\n                if (err) {\n                    reject(new HttpException(\"文件删除错误:\" + err.toString(), 406));\n                }\n                resolver();\n            });\n        }).catch(err => {\n            ex = err;\n        });\n        if (ex) {\n            throw ex;\n        }\n    }\n\n    async deleteIfExist(path: string): Promise<void> {\n        if (fs.existsSync(path)) {\n            let ex: any = \"\";\n            await new Promise((resolver, reject) => {\n                fs.unlink(path, (err) => {\n                    if (err) {\n                        reject(new HttpException(\"文件删除错误:\" + err.toString(), 406));\n                    }\n                    resolver();\n                });\n            }).catch(err => {\n                ex = err;\n            });\n            if (ex) {\n                throw ex;\n            }\n        }\n    }\n\n    // 获取文件状态，一般只有一个size能言用\n    async size(path: string): Promise<any> {\n        if (fs.existsSync(path)) {\n            let ex: any = \"\";\n            let size;\n            await new Promise((resolver, reject) => {\n                fs.stat(path, (err, stats) => {\n                    if (err) {\n                        reject(new HttpException(\"获取文件状态错误:\" + err.toString(), 407));\n                    }\n                    size = stats.size;\n                    resolver();\n                });\n            }).catch(err => {\n                ex = err;\n            });\n            if (ex) {\n                throw ex;\n            }\n            return size;\n        } else {\n            return undefined;\n        }\n    }\n\n    exist(path: string): boolean {\n        return fs.existsSync(path);\n    }\n\n    async mkdir(path: string): Promise<void> {\n        let ex: any = \"\";\n        await new Promise((resolver, reject) => {\n            fs.mkdir(path, (err) => {\n                if (err) {\n                    reject(new HttpException(\"创建目录错误:\" + err.toString(), 407));\n                }\n                resolver();\n            });\n        }).catch(err => {\n            ex = err;\n        });\n        if (ex) {\n            throw ex;\n        }\n    }\n}\n"]}